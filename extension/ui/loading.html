<!DOCTYPE html>
<html><head>
<meta charset="utf-8"/>
<link crossorigin="" href="https://fonts.gstatic.com/" rel="preconnect"/>
<link as="style" href="https://fonts.googleapis.com/css2?display=swap&amp;family=Inter:wght@400;500;600;700&amp;family=Noto+Sans:wght@400;500;700;900" onload="this.rel='stylesheet'" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>
<title>Networking Score Loader</title>
<link href="data:image/x-icon;base64," rel="icon" type="image/x-icon"/>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<style>
    #progress-bar {
      background-color: #0b80ee;
      transition: width 0.1s ease;
    }
  </style>
<script>
    let loadingStartTime;
    let progressBar;
    let isLoadingComplete = false;
    let actualLoadingDone = false;
    let animationInterval;
    
    function startProgressAnimation() {
      loadingStartTime = Date.now();
      progressBar = document.getElementById('progress-bar');
      if (progressBar) {
        console.log('Starting realistic progress animation...');
        
        let currentProgress = 1;
        progressBar.style.width = currentProgress + '%';
        
        // Realistic progress stages with different speeds
        const progressStages = [
          { range: [1, 15], duration: 800, description: "Initial loading" },      // 0-0.8s: Quick start
          { range: [15, 35], duration: 1000, description: "Fetching data" },     // 0.8-1.8s: Steady progress  
          { range: [35, 60], duration: 800, description: "Processing" },         // 1.8-2.6s: Another burst
          { range: [60, 80], duration: 700, description: "Analyzing" },          // 2.6-3.3s: Slower
          { range: [80, 95], duration: 500, description: "Finalizing" },         // 3.3-3.8s: Slow down
          { range: [95, 99], duration: 200, description: "Almost done" }         // 3.8-4.0s: Crawl to 99%
        ];
        
        let stageIndex = 0;
        let stageStartTime = Date.now();
        
        const animateRealistic = () => {
          if (stageIndex >= progressStages.length) {
            // Reached 99%, wait for actual completion
            return;
          }
          
          const stage = progressStages[stageIndex];
          const stageElapsed = Date.now() - stageStartTime;
          const stageProgress = Math.min(stageElapsed / stage.duration, 1);
          
          // Random increment within stage range
          const stageRange = stage.range[1] - stage.range[0];
          const targetProgress = stage.range[0] + (stageProgress * stageRange);
          
          // Add some randomness for realistic feel
          const randomVariation = (Math.random() - 0.5) * 2; // -1 to +1
          currentProgress = Math.min(Math.max(targetProgress + randomVariation, currentProgress), stage.range[1]);
          
          progressBar.style.width = currentProgress + '%';
          console.log(`${stage.description}: ${currentProgress.toFixed(1)}%`);
          
          // Move to next stage when current is complete
          if (stageProgress >= 1) {
            stageIndex++;
            stageStartTime = Date.now();
            if (stageIndex < progressStages.length) {
              console.log(`Moving to stage: ${progressStages[stageIndex].description}`);
            } else {
              console.log('Reached 99%, waiting for actual completion...');
            }
          }
          
          // Continue animation
          if (stageIndex < progressStages.length) {
            setTimeout(animateRealistic, 100 + Math.random() * 100); // 100-200ms intervals for organic feel
          }
        };
        
        // Start the realistic animation
        animateRealistic();
        
        console.log('Realistic progress animation started - 4 seconds to 99%');
      } else {
        console.error('Progress bar element not found!');
      }
      
      // Check every 100ms if we should complete
      const checkCompletion = setInterval(() => {
        const elapsedTime = Date.now() - loadingStartTime;
        
        // Minimum 4 seconds AND actual loading must be done
        if (elapsedTime >= 4000 && actualLoadingDone) {
          clearInterval(checkCompletion);
          
          // Final push to 100%
          if (progressBar) {
            progressBar.style.width = '100%';
            console.log('Analysis complete! Progress: 100%');
          }
          
          isLoadingComplete = true;
          console.log('Loading complete - notifying parent...');
          
          // Small delay for visual satisfaction
          setTimeout(() => {
            if (window.parent && window.parent.onLoadingScreenComplete) {
              window.parent.onLoadingScreenComplete();
            } else if (window.onLoadingScreenComplete) {
              window.onLoadingScreenComplete();
            }
          }, 200);
        }
      }, 100);
    }
    
    // Function to be called when actual analysis is complete
    window.notifyAnalysisComplete = function() {
      console.log('Analysis complete notification received');
      actualLoadingDone = true;
    };
    
    document.addEventListener("DOMContentLoaded", function() {
      console.log('Loading screen DOM loaded');
      startProgressAnimation();
    });
  </script>
</head>
<body class="bg-slate-50" style='font-family: Inter, "Noto Sans", sans-serif;'>
<div class="relative flex size-full min-h-screen flex-col group/design-root overflow-x-hidden items-center justify-center">
<div class="layout-container flex flex-col items-center justify-center bg-white shadow-lg rounded-xl" style="width: 400px; height: 564px;">
<div class="layout-content-container flex flex-col w-full h-full items-center justify-center text-center p-10" role="status" aria-live="polite" aria-label="Loading networking score analysis">
<div class="mb-8" aria-hidden="true">
<img alt="Cute loading animation" class="w-32 h-32 object-contain rounded-lg" src="https://i.imgur.com/zU3v0QV.gif"/>
</div>
<h2 class="text-slate-800 text-xl font-semibold leading-tight mb-4">Calculating networking score...</h2>
<p class="text-slate-600 text-sm font-normal leading-relaxed mb-8">Analyzing profile, this may take a few moments.</p>
<div class="w-full h-3 rounded-full overflow-hidden" role="progressbar" aria-label="Analysis progress" aria-valuemin="0" aria-valuemax="100">
<div id="progress-bar" class="h-full rounded-full transition-all duration-100" style="width: 1%; background-color: #0b80ee;"></div>
</div>
</div>
</div>
</div>

</body></html>